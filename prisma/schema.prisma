generator client {
  provider = "prisma-client"
  output   = "./generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model conversations {
  conversation_id String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id         String?    @db.Uuid
  is_open         Boolean?   @default(true)
  created_at      DateTime?  @default(now()) @db.Timestamp(6)
  updated_at      DateTime?  @default(now()) @db.Timestamp(6)
  users           users?     @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
  messages        messages[]
}

model label_reviews {
  review_id   BigInt    @id @default(autoincrement())
  message_id  BigInt?
  old_label   String?   @db.VarChar(100)
  new_label   String?   @db.VarChar(100)
  reviewed_by String?   @db.VarChar(100)
  reviewed_at DateTime? @default(now()) @db.Timestamp(6)
  messages    messages? @relation(fields: [message_id], references: [message_id], onDelete: NoAction, onUpdate: NoAction)
}

model labels {
  label_id             String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  label_name           String      @unique @db.VarChar(100)
  description          String?
  confidence_threshold Decimal?    @default(0.70) @db.Decimal(4, 3)
  auto_send            Boolean?    @default(true)
  requires_human       Boolean?    @default(false)
  created_at           DateTime?   @default(now()) @db.Timestamp(6)
  templates            templates[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model messages {
  message_id         BigInt          @id @default(autoincrement())
  conversation_id    String?         @db.Uuid
  user_id            String?         @db.Uuid
  direction          String?         @db.VarChar(10)
  actor              String?         @db.VarChar(20)
  message_text       String?
  ai_label           String?         @db.VarChar(100)
  ai_confidence      Decimal?        @db.Decimal(4, 3)
  final_label        String?         @db.VarChar(100)
  approved_by_human  Boolean?        @default(false)
  status             String?         @db.VarChar(30)
  twilio_message_sid String?         @db.VarChar(100)
  created_at         DateTime?       @default(now()) @db.Timestamp(6)
  label_reviews      label_reviews[]
  conversations      conversations?  @relation(fields: [conversation_id], references: [conversation_id], onDelete: NoAction, onUpdate: NoAction)
  users              users?          @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
}

model templates {
  template_id   String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  label_id      String?   @db.Uuid
  template_name String    @db.VarChar(150)
  language      String?   @default("en") @db.VarChar(10)
  body          String
  is_active     Boolean?  @default(true)
  created_at    DateTime? @default(now()) @db.Timestamp(6)
  labels        labels?   @relation(fields: [label_id], references: [label_id], onDelete: NoAction, onUpdate: NoAction)
}

model users {
  user_id       String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  phone_number  String          @unique @db.VarChar(20)
  created_at    DateTime?       @default(now()) @db.Timestamp(6)
  last_seen_at  DateTime?       @db.Timestamp(6)
  conversations conversations[]
  messages      messages[]
}
